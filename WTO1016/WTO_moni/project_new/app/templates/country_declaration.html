<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>共同宣言查看 - {{ country_name }}代表团｜WTO 模拟谈判</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .topbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 16px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .topbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .topbar-left h1 {
            font-size: 20px;
            color: #2c3e50;
            font-weight: 600;
        }

        .country-identity {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .country-flag-small {
            width: 32px;
            height: 24px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .country-name-small {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 16px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            margin: 0 0 8px;
            font-size: 32px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            margin: 0;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .declaration-info {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .declaration-info h3 {
            margin: 0 0 16px;
            color: #1e293b;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-label {
            font-weight: 600;
            color: #374151;
        }
        
        .info-value {
            color: #6b7280;
            font-weight: 500;
        }
        
        .my-contribution {
            background: #fef3c7;
            border: 1px solid #fde68a;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .my-contribution h4 {
            color: #92400e;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .contribution-text {
            color: #374151;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .participation-status {
            background: #ecfdf5;
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .participation-status strong {
            color: #065f46;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .panel-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .panel-title {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
        }

        .source-files {
            max-height: 350px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .file-item.my-file {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        
        .file-item.included {
            border-left-color: #10b981;
            background: #ecfdf5;
        }
        
        .file-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .country-flag {
            width: 32px;
            height: 24px;
            border-radius: 4px;
            object-fit: cover;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 2px;
        }
        
        .file-meta {
            font-size: 12px;
            color: #6b7280;
        }

        .file-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }

        .file-status.included {
            background: #10b981;
            color: white;
        }

        .file-status.my-file {
            background: #f59e0b;
            color: white;
        }

        .declaration-viewer {
            height: 100%;
        }

        .declaration-content {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 24px;
            min-height: 500px;
            line-height: 1.8;
            font-size: 16px;
            color: #374151;
            white-space: pre-wrap;
            border-left: 4px solid #3b82f6;
        }

        .declaration-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .feedback-section {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .feedback-textarea {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .feedback-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .stats-section {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }
        
        .stat-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .btn-warning:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
        }
        
        .alert-error {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }
        
        .alert.show {
            display: block;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .declaration-actions {
                flex-direction: column;
            }
            
            .topbar-content {
                flex-direction: column;
                gap: 12px;
            }
        }

    </style>
</head>
<body>
    <header class="topbar">
        <div class="topbar-content">
            <div class="topbar-left">
                <h1>WTO 模拟谈判 - 共同宣言</h1>
            </div>
            <div class="country-identity">
                <img class="country-flag-small" src="{{ country_flag_url }}" alt="{{ country_name }}" onerror="this.src='/static/flags/default.png'">
                <span class="country-name-small">{{ country_name }}代表团</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="header">
            <h1>📜 共同宣言</h1>
            <p>查看和确认会议达成的共同宣言</p>
        </div>

        <!-- 宣言信息 -->
        <div class="declaration-info">
            <h3>📋 宣言信息</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">会议编号：</span>
                    <span class="info-value">{{ session_id or '未设置' }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">委员会：</span>
                    <span class="info-value">{{ committee_name or '未设置' }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">议题：</span>
                    <span class="info-value">{{ agenda or '未设置' }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">宣言发布：</span>
                    <span class="info-value" id="declaration-time">{{ declaration_time or '未设置' }}</span>
                </div>
            </div>
            
            <div class="my-contribution">
                <h4>{{ country_flag_emoji }} {{ country_name }}的贡献</h4>
                <div class="contribution-text" id="my-contribution-text">
                    正在加载您的贡献信息...
                </div>
            </div>
            
            <div class="participation-status">
                <strong>参与状态：</strong>
                <span id="participation-status-text">正在加载参与状态...</span>
            </div>
        </div>

        <!-- 提示信息 -->
        <div id="alert" class="alert"></div>


        <!-- 主要内容 -->
        <div class="main-content">
            <!-- 纳入宣言的文件 -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-icon">📄</div>
                    <div class="panel-title">纳入宣言的文件</div>
                </div>
                
                <div class="source-files" id="source-files">
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <div style="font-size: 48px; margin-bottom: 16px;">📄</div>
                        <div>正在加载文件信息...</div>
                    </div>
                </div>
            </div>
            
            <!-- 宣言内容查看 -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-icon">📜</div>
                    <div class="panel-title">共同宣言内容</div>
                </div>
                
                <div class="declaration-viewer">
                    <div class="declaration-content" id="declaration-content">
                        正在加载共同宣言内容...
                    </div>
                    
                    <div class="declaration-actions">
                        <button class="btn btn-primary" onclick="downloadDeclaration()">
                            📥 下载宣言
                        </button>
                        <button class="btn btn-success" onclick="confirmDeclaration()" id="confirm-btn">
                            ✅ 确认宣言
                        </button>
                        <button class="btn btn-warning" onclick="provideFeedback()">
                            💬 提供反馈
                        </button>
                        <button class="btn btn-secondary" onclick="shareDeclaration()">
                            📤 分享宣言
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 反馈意见 -->
        <div class="feedback-section">
            <div class="panel-header">
                <div class="panel-title">
                    <div class="panel-icon">💬</div>
                    <div class="panel-title-text">对宣言的反馈意见</div>
                </div>
            </div>
            
            <textarea class="feedback-textarea" id="feedback-content" placeholder="请在此处提供您对共同宣言的反馈意见和建议...

您可以就以下方面提供意见：
1. 宣言内容的准确性和完整性
2. {{ country_name }}立场的体现程度
3. 具体条款的表述建议
4. 实施方案的可行性
5. 其他改进建议"></textarea>
            
            <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: center;">
                <button class="btn btn-success" onclick="submitFeedback()">📤 提交反馈</button>
                <button class="btn btn-secondary" onclick="saveFeedbackDraft()">💾 保存草稿</button>
            </div>
        </div>

        <!-- 统计信息 -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="signing-countries">0</div>
                    <div class="stat-label">签署国家</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="declaration-words">0</div>
                    <div class="stat-label">宣言字数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="key-points">0</div>
                    <div class="stat-label">核心要点</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="my-status">未确认</div>
                    <div class="stat-label">您的状态</div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // 全局变量
        let sessionId = "{{ session_id or '' }}";
        let committeeName = "{{ committee_name or '' }}";
        let agenda = "{{ agenda or '' }}";
        let countryId = "{{ country_id or '' }}";
        let countryName = "{{ country_name or '' }}";
        
        let confirmationStatus = false;
        let feedbackSubmitted = false;
        let declarationData = null;

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('与会国共同宣言页面已加载');
            console.log('国家信息:', { countryId, countryName });
            
            loadDeclaration();
            loadIncludedFiles();
            loadMyParticipation();
            initializePage();
        });

        // 加载共同宣言
        async function loadDeclaration() {
            try {
                const response = await fetch(`/api/get_declarations?session_id=${encodeURIComponent(sessionId)}`);
                const data = await response.json();
                
                if (data.code === 200 && data.data && data.data.length > 0) {
                    // 获取最新的宣言
                    declarationData = data.data[0];
                    
                    document.getElementById('declaration-content').textContent = declarationData.declaration;
                    document.getElementById('declaration-time').textContent = formatDateTime(declarationData.created_at || declarationData.generated_at);
                    
                    // 更新统计信息
                    const wordCount = declarationData.declaration.length;
                    const signingCountries = declarationData.participating_countries || [];
                    
                    document.getElementById('signing-countries').textContent = signingCountries.length;
                    document.getElementById('declaration-words').textContent = wordCount.toLocaleString();
                    document.getElementById('key-points').textContent = '5'; // 可以通过分析文本计算
                    
                    console.log('共同宣言已加载');
                } else {
                    document.getElementById('declaration-content').textContent = '共同宣言尚未生成，请等待主席完成宣言制作。';
                    showAlert('共同宣言尚未生成，请等待主席完成', 'error');
                }
            } catch (error) {
                console.error('加载共同宣言失败:', error);
                showAlert('加载共同宣言时发生错误', 'error');
            }
        }

        // 加载纳入宣言的文件
        async function loadIncludedFiles() {
            try {
                const response = await fetch(`/api/get_passed_submissions?session_id=${encodeURIComponent(sessionId)}`);
                const data = await response.json();
                
                if (data.code === 200) {
                    const passedFiles = data.data || [];
                    
                    // 获取国家信息
                    const countriesResponse = await fetch(`/api/countries?session_id=${encodeURIComponent(sessionId)}`);
                    const countriesData = await countriesResponse.json();
                    
                    if (countriesData.code === 200) {
                        const allCountries = countriesData.data || [];
                        
                        const sourceFilesEl = document.getElementById('source-files');
                        
                        if (passedFiles.length === 0) {
                            sourceFilesEl.innerHTML = `
                                <div style="text-align: center; padding: 40px; color: #6b7280;">
                                    <div style="font-size: 48px; margin-bottom: 16px;">📄</div>
                                    <div>暂无通过投票的文件</div>
                                </div>
                            `;
                            return;
                        }
                        
                        sourceFilesEl.innerHTML = passedFiles.map(file => {
                            const country = allCountries.find(c => c.id === file.country_id);
                            const isMyFile = file.country_id === countryId;
                            const statusClass = isMyFile ? 'my-file' : 'included';
                            const statusText = isMyFile ? `${countryName} 我的文件` : '✅ 已纳入';
                            
                            return `
                                <div class="file-item ${statusClass}">
                                    <img class="country-flag" src="${country ? country.flag_url : '/static/flags/default.png'}" alt="${country ? country.name : '未知'}" onerror="this.src='/static/flags/default.png'">
                                    <div class="file-info">
                                        <div class="file-title">${file.file_name || '文本提交'}</div>
                                        <div class="file-meta">${country ? country.name : '未知国家'} • 已通过投票</div>
                                    </div>
                                    <span class="file-status ${statusClass}">${statusText}</span>
                                </div>
                            `;
                        }).join('');
                        
                        // 更新我的贡献信息
                        const myFile = passedFiles.find(f => f.country_id === countryId);
                        if (myFile) {
                            document.getElementById('my-contribution-text').textContent = 
                                `您的${myFile.file_name || '文本提交'}已被纳入共同宣言的制定过程中，您的观点和建议得到了体现。`;
                            document.getElementById('participation-status-text').textContent = 
                                '您的文件已通过投票并纳入宣言';
                        } else {
                            document.getElementById('my-contribution-text').textContent = 
                                '您的文件未通过投票，但您仍可以查看和确认最终的共同宣言。';
                            document.getElementById('participation-status-text').textContent = 
                                '您的文件未纳入宣言，但可参与确认过程';
                        }
                    }
                }
            } catch (error) {
                console.error('加载纳入文件失败:', error);
            }
        }

        // 加载我的参与情况
        async function loadMyParticipation() {
            try {
                const response = await fetch(`/api/get_declaration_participation?session_id=${encodeURIComponent(sessionId)}&country_id=${encodeURIComponent(countryId)}`);
                const data = await response.json();
                
                if (data.code === 200 && data.data) {
                    confirmationStatus = data.data.confirmed || false;
                    feedbackSubmitted = data.data.feedback_submitted || false;
                    
                    // 更新状态显示
                    document.getElementById('my-status').textContent = confirmationStatus ? '已确认' : '未确认';
                    
                    if (confirmationStatus) {
                        const confirmBtn = document.getElementById('confirm-btn');
                        confirmBtn.textContent = '✅ 已确认';
                        confirmBtn.disabled = true;
                    }
                    
                    if (feedbackSubmitted) {
                        showAlert('您已提交过反馈意见', 'success');
                    }
                }
            } catch (error) {
                console.error('加载参与情况失败:', error);
            }
        }

        // 下载宣言
        function downloadDeclaration() {
            if (!declarationData) {
                showAlert('宣言尚未生成', 'error');
                return;
            }
            
            const content = declarationData.declaration;
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `共同宣言_${sessionId}_${countryName}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showAlert('宣言已下载', 'success');
        }

        // 确认宣言
        async function confirmDeclaration() {
            if (confirmationStatus) {
                showAlert('您已确认过此宣言', 'success');
                return;
            }
            
            if (confirm(`确认此共同宣言代表${countryName}的最终立场吗？确认后将无法撤回。`)) {
                try {
                    const response = await fetch('/api/confirm_declaration', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            session_id: sessionId,
                            country_id: countryId,
                            country_name: countryName
                        })
                    });

                    const data = await response.json();
                    
                    if (data.code === 200) {
                        confirmationStatus = true;
                        showAlert('您已确认共同宣言，感谢参与！', 'success');
                        
                        // 更新状态显示
                        document.getElementById('my-status').textContent = '已确认';
                        document.getElementById('participation-status-text').textContent = '您已确认共同宣言';
                        
                        // 更新按钮状态
                        const confirmBtn = document.getElementById('confirm-btn');
                        confirmBtn.textContent = '✅ 已确认';
                        confirmBtn.disabled = true;
                    } else {
                        showAlert(data.message || '确认失败', 'error');
                    }
                    
                } catch (error) {
                    console.error('确认宣言失败:', error);
                    showAlert('确认时发生错误', 'error');
                }
            }
        }

        // 提供反馈
        function provideFeedback() {
            const feedbackSection = document.querySelector('.feedback-section');
            feedbackSection.scrollIntoView({ behavior: 'smooth' });
            document.getElementById('feedback-content').focus();
        }

        // 提交反馈
        async function submitFeedback() {
            const feedback = document.getElementById('feedback-content').value.trim();
            if (!feedback) {
                showAlert('请先输入反馈内容', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/submit_declaration_feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        country_id: countryId,
                        country_name: countryName,
                        feedback: feedback
                    })
                });

                const data = await response.json();
                
                if (data.code === 200) {
                    feedbackSubmitted = true;
                    showAlert('反馈已提交给主席，感谢您的意见！', 'success');
                    saveFeedbackDraft(); // 保存本地副本
                } else {
                    showAlert(data.message || '提交反馈失败', 'error');
                }
                
            } catch (error) {
                console.error('提交反馈失败:', error);
                showAlert('提交反馈时发生错误', 'error');
            }
        }

        // 保存反馈草稿
        function saveFeedbackDraft() {
            const feedback = document.getElementById('feedback-content').value;
            localStorage.setItem(`declaration-feedback-draft-${countryName}-${sessionId}`, feedback);
            showAlert('反馈草稿已保存', 'success');
        }

        // 分享宣言
        function shareDeclaration() {
            if (!declarationData) {
                showAlert('宣言尚未生成', 'error');
                return;
            }
            
            if (navigator.share) {
                navigator.share({
                    title: 'WTO共同宣言',
                    text: '国际贸易争端解决机制改革共同宣言',
                    url: window.location.href
                });
            } else {
                // 复制到剪贴板
                const content = declarationData.declaration;
                navigator.clipboard.writeText(content).then(() => {
                    showAlert('宣言内容已复制到剪贴板', 'success');
                });
            }
        }

        // 格式化日期时间
        function formatDateTime(isoString) {
            if (!isoString) return '未知时间';
            const date = new Date(isoString);
            return date.toLocaleString('zh-CN');
        }

        // 显示提示信息
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }

        // 页面初始化
        function initializePage() {
            // 加载保存的反馈草稿
            const savedFeedback = localStorage.getItem(`declaration-feedback-draft-${countryName}-${sessionId}`);
            if (savedFeedback) {
                document.getElementById('feedback-content').value = savedFeedback;
            }
            
            // 自动保存反馈草稿
            const feedbackTextarea = document.getElementById('feedback-content');
            let autoSaveTimer;
            feedbackTextarea.addEventListener('input', () => {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(() => {
                    saveFeedbackDraft();
                }, 5000); // 5秒后自动保存
            });
        }

    </script>
</body>
</html>
