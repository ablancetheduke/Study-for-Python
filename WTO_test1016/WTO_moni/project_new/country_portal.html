<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>与会国代表门户 - WTO模拟谈判</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 16px;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            color: white;
        }

        .header h1 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 16px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 20px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .country-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .selector-title {
            font-size: 24px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }

        .country-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
            max-height: 500px;
            overflow-y: auto;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(5px);
        }

        .country-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .country-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .country-card.selected {
            border-color: #10b981;
            background: #ecfdf5;
        }


        .country-flag-large {
            width: 48px;
            height: 36px;
            border-radius: 4px;
            margin: 0 auto 8px;
            object-fit: cover;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .country-name-large {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
            font-size: 14px;
            line-height: 1.2;
        }

        .country-status {
            font-size: 11px;
            color: #6b7280;
        }

        .session-input {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }

        .session-input input {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            width: 200px;
        }

        .session-input input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .function-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .function-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .function-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .section-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #1e293b;
        }

        .section-desc {
            color: #6b7280;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .function-btn {
            display: block;
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }

        .function-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .function-btn.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .function-btn.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .function-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .status-indicator.available {
            background: #10b981;
        }

        .status-indicator.unavailable {
            background: #ef4444;
        }

        .footer {
            text-align: center;
            color: white;
            opacity: 0.8;
            margin-top: 40px;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
            font-weight: 500;
            text-align: center;
        }
        
        .alert-success {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
        }
        
        .alert-error {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }
        
        .alert.show {
            display: block;
        }

        /* 实时信息面板动画 */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .realtime-info-panel {
            animation: fadeIn 0.5s ease;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .function-grid {
                grid-template-columns: 1fr;
            }

            .country-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .header h1 {
                font-size: 32px;
            }

            .header p {
                font-size: 18px;
            }

            /* 实时信息面板响应式 */
            .realtime-info-panel > div:first-child {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .realtime-info-panel .info-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .realtime-info-panel .meeting-timer {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌍 与会国代表门户</h1>
            <p>WTO模拟谈判系统 - 代表参与平台</p>
            <div style="font-size: 16px; opacity: 0.7;">选择您的国家身份，参与完整的会议流程</div>
        </div>

        <!-- 国家选择 -->
        <div class="country-selector">
            <div class="selector-title">选择您的国家身份</div>
            <div style="text-align: center; margin-bottom: 16px; color: #6b7280; font-size: 14px;" id="country-count">
                正在加载国家数据...
            </div>
            
            <!-- 搜索框 -->
            <div style="margin-bottom: 20px; text-align: center;">
                <input type="text" id="country-search" placeholder="搜索国家名称..." style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; width: 300px; max-width: 100%;">
            </div>
            
            <!-- 国家网格 -->
            <div class="country-grid" id="country-grid">
                <div style="text-align: center; padding: 40px; color: #6b7280; grid-column: 1 / -1;">
                    <div style="font-size: 48px; margin-bottom: 16px;">🌍</div>
                    <div>正在加载国家列表...</div>
                </div>
            </div>
            
            <div class="session-input">
                <label for="session-id-input" style="font-weight: 600; color: #374151;">会议编号:</label>
                <input type="text" id="session-id-input" placeholder="请输入会议编号" value="">
                <button onclick="updateSessionId()" style="padding: 12px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">更新</button>
            </div>
        </div>

        

        <!-- 提示信息 -->
        <div id="alert" class="alert"></div>

        <!-- 功能模块 -->
        <div class="function-grid" id="function-grid" style="display: none;">
            <!-- 文件提交 -->
            <div class="function-section">
                <div class="section-header">
                    <div class="section-icon">📄</div>
                    <div class="section-title">文件提交</div>
                </div>
                <div class="section-desc">
                    提交您的立场文件，阐述观点，为后续讨论和投票奠定基础
                </div>
                <a href="#" class="function-btn primary" id="file-submit-btn" onclick="goToFileSubmit()">
                    📝 提交立场文件
                    <span class="status-indicator available"></span>
                </a>
                <div style="font-size: 12px; color: #6b7280; text-align: center;">
                    上传文件 • 填写信息 • 提交立场
                </div>
            </div>

            <!-- 动议参与 -->
            <div class="function-section">
                <div class="section-header">
                    <div class="section-icon">🎤</div>
                    <div class="section-title">动议讨论</div>
                </div>
                <div class="section-desc">
                    参与动议讨论，查看发言顺序，申请发言机会，等待轮次发言
                </div>
                <a href="#" class="function-btn" id="motion-btn" onclick="goToMotion()">
                    🎙️ 参与动议讨论
                    <span class="status-indicator available"></span>
                </a>
                <div style="font-size: 12px; color: #6b7280; text-align: center;">
                    查看发言顺序 • 申请发言 • 等待轮次
                </div>
            </div>

            <!-- 文件投票 -->
            <div class="function-section">
                <div class="section-header">
                    <div class="section-icon">🗳️</div>
                    <div class="section-title">文件投票</div>
                </div>
                <div class="section-desc">
                    对各国提交的文件进行投票表决，表达您的立场和观点
                </div>
                <a href="#" class="function-btn success" id="vote-btn" onclick="goToVote()">
                    📊 文件投票表决
                    <span class="status-indicator available"></span>
                </a>
                <div style="font-size: 12px; color: #6b7280; text-align: center;">
                    查看文件 • 投票表决 • 提交结果
                </div>
            </div>

            <!-- 共同宣言 -->
            <div class="function-section">
                <div class="section-header">
                    <div class="section-icon">📜</div>
                    <div class="section-title">共同宣言</div>
                </div>
                <div class="section-desc">
                    查看会议达成的共同宣言，确认最终立场，提供反馈意见
                </div>
                <a href="#" class="function-btn warning" id="declaration-btn" onclick="goToDeclaration()">
                    📋 查看共同宣言
                    <span class="status-indicator available"></span>
                </a>
                <div style="font-size: 12px; color: #6b7280; text-align: center;">
                    查看宣言 • 确认立场 • 提供反馈
                </div>
            </div>
        </div>

        <!-- 当前选择的国家信息 -->
        <div id="selected-country-info" style="display: none;">
            <div style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 16px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); text-align: center;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 20px;">
                    <img id="selected-flag" src="" alt="" style="width: 48px; height: 36px; border-radius: 6px;">
                    <div>
                        <div style="font-size: 24px; font-weight: 600; color: #1e293b;" id="selected-name"></div>
                        <div style="font-size: 14px; color: #6b7280;">代表团已选择</div>
                    </div>
                </div>
                <div style="font-size: 14px; color: #374151; margin-bottom: 20px;">
                    会议编号：<strong id="selected-session">0000</strong> | 
                    请点击保存按钮确认您的选择
                </div>
                <button id="save-country-btn" onclick="saveCountrySelection()" style="
                    background: linear-gradient(135deg, #10b981, #059669);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    padding: 12px 24px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    margin-right: 12px;
                ">保存选择</button>
                <button id="change-country-btn" onclick="changeCountrySelection()" style="
                    background: linear-gradient(135deg, #6b7280, #4b5563);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    padding: 12px 24px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">重新选择</button>
            </div>
        </div>

        <div class="footer">
            <p>🎯 完整的与会国参与体验</p>
            <p>💡 所有功能都已集成真实API和数据库</p>
            
            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px; flex-wrap: wrap;">
                <div style="background: rgba(255, 255, 255, 0.1); padding: 8px 16px; border-radius: 20px; font-size: 14px;">🎤 动议参与</div>
                <div style="background: rgba(255, 255, 255, 0.1); padding: 8px 16px; border-radius: 20px; font-size: 14px;">🗳️ 文件投票</div>
                <div style="background: rgba(255, 255, 255, 0.1); padding: 8px 16px; border-radius: 20px; font-size: 14px;">📜 宣言确认</div>
                <div style="background: rgba(255, 255, 255, 0.1); padding: 8px 16px; border-radius: 20px; font-size: 14px;">💬 意见反馈</div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let selectedCountryId = '';
        let selectedCountryName = '';
        let selectedCountryFlag = '';
        let sessionId = '0000';
        let allCountries = [];
        let filteredCountries = [];

        // 获取URL参数
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // 页面加载完成
        document.addEventListener('DOMContentLoaded', function() {
            console.log('与会国代表门户已加载');

            // 从URL参数获取session_id和country_id
            const urlSessionId = getUrlParameter('session_id');
            const urlCountryId = getUrlParameter('country_id');

            if (urlSessionId) {
                sessionId = urlSessionId;
                document.getElementById('session-id-input').value = sessionId;
            }

            loadCountries().then(async () => {
                // 检查是否有已保存的国家选择
                if (urlCountryId) {
                    try {
                        // 检查该国家是否已保存选择
                        const checkResponse = await fetch(`/api/save_country_selection?session_id=${encodeURIComponent(sessionId)}&country_id=${encodeURIComponent(urlCountryId)}`, {
                            method: 'GET'
                        });

                        if (checkResponse.ok) {
                            // 国家已保存，直接显示功能区域
                            selectedCountryId = urlCountryId;
                            selectedCountryName = getUrlParameter('country_name') || '';

                            // 显示功能区域和实时信息面板
                            document.getElementById('function-grid').style.display = 'grid';
                            document.getElementById('realtime-info-panel').style.display = 'block';
                            loadRealtimeInfo();
                            showAlert('欢迎回到与会国门户', 'success');
                        } else {
                            // 国家未保存，自动选择该国家并显示保存按钮
                            selectCountryById(urlCountryId);
                        }
                    } catch (error) {
                        // 检查失败，回退到自动选择
                        selectCountryById(urlCountryId);
                    }
                }
                // 如果没有country_id参数，显示国家选择界面
            });

            setupSearchFilter();

            // 开始实时信息更新
            startRealtimeInfo();
        });

        // 加载国家列表
        async function loadCountries() {
            try {
                const response = await fetch(`/api/countries?session_id=${sessionId}`);
                const data = await response.json();
                
                if (data.code === 200) {
                    allCountries = data.data || [];
                    filteredCountries = [...allCountries];
                    renderCountries();
                    console.log('国家列表已加载:', allCountries.length, '个国家');
                    return true;
                } else {
                    showAlert('加载国家列表失败：' + (data.message || '未知错误'), 'error');
                    return false;
                }
            } catch (error) {
                console.error('加载国家列表失败:', error);
                return false;
            }
        }

        // 根据ID选择国家
        function selectCountryById(countryId) {
            const country = allCountries.find(c => c.id === countryId);
            if (country) {
                selectCountry(country.id, country.name, country.flag_url);
                showAlert(`已选择代表国家：${country.name}`, 'success');
            } else {
                showAlert('未找到指定的国家', 'error');
            }
        }

        // 保存国家选择到数据库
        async function saveCountrySelection() {
            if (!selectedCountryId || !selectedCountryName) {
                showAlert('请先选择国家', 'error');
                return;
            }

            console.log('保存国家选择:', {
                session_id: sessionId,
                country_id: selectedCountryId,
                country_name: selectedCountryName,
                country_flag: selectedCountryFlag
            });

            try {
                const response = await fetch('/api/save_country_selection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        country_id: selectedCountryId,
                        country_name: selectedCountryName,
                        country_flag: selectedCountryFlag
                    })
                });

                console.log('保存响应状态:', response.status);
                const data = await response.json();
                console.log('保存响应数据:', data);
                
                if (data.code === 200) {
                    showAlert('国家选择已保存！', 'success');
                    // 隐藏保存按钮，显示功能区域和实时信息面板
                    document.getElementById('save-country-btn').style.display = 'none';
                    document.getElementById('change-country-btn').style.display = 'none';
                    document.getElementById('function-grid').style.display = 'grid';
                    document.getElementById('realtime-info-panel').style.display = 'block';

                    // 开始加载实时信息
                    loadRealtimeInfo();
                } else {
                    showAlert('保存失败：' + data.message, 'error');
                }
            } catch (error) {
                console.error('保存国家选择失败:', error);
            }
        }

        // 重新选择国家
        function changeCountrySelection() {
            // 隐藏选中国家信息，显示国家选择区域
            document.getElementById('selected-country-info').style.display = 'none';
            document.getElementById('country-selector').style.display = 'block';
            
            // 重置选择状态
            selectedCountryId = '';
            selectedCountryName = '';
            selectedCountryFlag = '';

            showAlert('请重新选择国家', 'info');
        }

        // 渲染国家列表
        function renderCountries() {
            const countryGrid = document.getElementById('country-grid');
            const countryCount = document.getElementById('country-count');
            
            // 更新国家数量显示
            if (filteredCountries.length === allCountries.length) {
                countryCount.textContent = `共 ${allCountries.length} 个国家可选`;
            } else {
                countryCount.textContent = `找到 ${filteredCountries.length} 个国家（共 ${allCountries.length} 个）`;
            }
            
            if (filteredCountries.length === 0) {
                countryGrid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6b7280; grid-column: 1 / -1;">
                        <div style="font-size: 48px; margin-bottom: 16px;">🔍</div>
                        <div>未找到匹配的国家</div>
                        <div style="margin-top: 8px; font-size: 14px;">请尝试其他搜索关键词</div>
                    </div>
                `;
                return;
            }

            countryGrid.innerHTML = filteredCountries.map(country => `
                <div class="country-card" onclick="selectCountry('${country.id}', '${country.name}', '${country.flag_url}')">
                    <img class="country-flag-large" src="${country.flag_url}" alt="${country.name}" onerror="this.src='/static/flags/default.png'">
                    <div class="country-name-large">${country.name}</div>
                    
                </div>
            `).join('');
        }

        // 设置搜索过滤
        function setupSearchFilter() {
            const searchInput = document.getElementById('country-search');
            
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                
                if (searchTerm === '') {
                    filteredCountries = [...allCountries];
                } else {
                    filteredCountries = allCountries.filter(country =>
                        country.name.toLowerCase().includes(searchTerm)
                    );
                }
                
                renderCountries();
            });

            // 添加搜索框焦点样式
            searchInput.addEventListener('focus', function() {
                this.style.borderColor = '#3b82f6';
                this.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.1)';
            });

            searchInput.addEventListener('blur', function() {
                this.style.borderColor = '#e5e7eb';
                this.style.boxShadow = 'none';
            });
        }

        // 选择国家
        function selectCountry(countryId, countryName, countryFlag) {
            selectedCountryId = countryId;
            selectedCountryName = countryName;
            selectedCountryFlag = countryFlag;

            // 更新选中状态
            document.querySelectorAll('.country-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.country-card').classList.add('selected');

            // 显示选中的国家信息
            document.getElementById('selected-flag').src = countryFlag;
            document.getElementById('selected-name').textContent = countryName;
            document.getElementById('selected-session').textContent = sessionId;
            document.getElementById('selected-country-info').style.display = 'block';

            // 隐藏国家选择区域
            document.getElementById('country-selector').style.display = 'none';

            // 显示保存按钮
            document.getElementById('save-country-btn').style.display = 'inline-block';
            document.getElementById('change-country-btn').style.display = 'inline-block';

            showAlert(`已选择 ${countryName} 代表团身份，请点击保存按钮确认`, 'success');
        }

        // 更新会议编号
        async function updateSessionId() {
            const newSessionId = document.getElementById('session-id-input').value.trim();
            if (newSessionId) {
                try {
                    // 检查会议是否存在
                    const response = await fetch(`/api/get_session_info?session_id=${encodeURIComponent(newSessionId)}`);
                    const data = await response.json();
                    
                    if (data.code === 200) {
                        // 会议存在
                        sessionId = newSessionId;
                        if (selectedCountryId) {
                            document.getElementById('selected-session').textContent = sessionId;
                        }
                        showAlert(`会议编号已更新为：${sessionId}，正在重新加载国家列表...`, 'success');
                        loadCountries();
                    } else if (data.code === 404) {
                        // 会议不存在，询问是否创建
                        const createNew = confirm(`会议编号 ${newSessionId} 不存在。\n\n是否要创建新的会议？\n\n点击"确定"创建新会议\n点击"取消"重新输入会议编号`);
                        
                        if (createNew) {
                            await createNewSessionForCountry(newSessionId);
                        } else {
                            document.getElementById('session-id-input').focus();
                            document.getElementById('session-id-input').select();
                        }
                    } else {
                        showAlert('检查会议信息失败：' + (data.message || '未知错误'), 'error');
                    }
                } catch (error) {
                    console.error('检查会议信息失败:', error);
                    showAlert('网络错误，请检查连接后重试', 'error');
                }
            }
        }

        // 为与会国创建新会议
        async function createNewSessionForCountry(sessionId) {
            try {
                showAlert('正在创建新会议...', 'success');
                
                const response = await fetch('/api/create_new_session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        committee_name: 'WTO委员会',
                        agenda: '会议议题',
                        created_by: 'country'
                    })
                });
                
                const data = await response.json();
                
                if (data.code === 200) {
                    window.sessionId = sessionId;
                    if (selectedCountryId) {
                        document.getElementById('selected-session').textContent = sessionId;
                    }
                    
                    showAlert(`新会议 ${sessionId} 创建成功！正在加载国家列表...`, 'success');
                    loadCountries();
                } else {
                    showAlert('创建新会议失败：' + (data.message || '未知错误'), 'error');
                }
                
            } catch (error) {
                console.error('创建新会议失败:', error);
                showAlert('创建新会议时发生错误', 'error');
            }
        }

        // 跳转到文件提交
        function goToFileSubmit() {
            if (!selectedCountryId) {
                showAlert('请先选择您的国家身份', 'error');
                return;
            }
            
            const url = `/file-upload-submit?session_id=${encodeURIComponent(sessionId)}&committee_name=WTO争端解决委员会&agenda=国际贸易争端解决机制改革&country_id=${encodeURIComponent(selectedCountryId)}&country_name=${encodeURIComponent(selectedCountryName)}`;
            window.location.href = url;
        }

        // 跳转到动议参与
        function goToMotion() {
            if (!selectedCountryId) {
                showAlert('请先选择您的国家身份', 'error');
                return;
            }
            
            const url = `/country-motion?session_id=${encodeURIComponent(sessionId)}&committee_name=WTO争端解决委员会&agenda=国际贸易争端解决机制改革&country_id=${encodeURIComponent(selectedCountryId)}&country_name=${encodeURIComponent(selectedCountryName)}`;
            window.location.href = url;
        }

        // 跳转到文件投票
        function goToVote() {
            if (!selectedCountryId) {
                showAlert('请先选择您的国家身份', 'error');
                return;
            }
            
            const url = `/country-file-vote?session_id=${encodeURIComponent(sessionId)}&committee_name=WTO争端解决委员会&agenda=国际贸易争端解决机制改革&country_id=${encodeURIComponent(selectedCountryId)}&country_name=${encodeURIComponent(selectedCountryName)}`;
            window.location.href = url;
        }

        // 跳转到共同宣言
        function goToDeclaration() {
            if (!selectedCountryId) {
                showAlert('请先选择您的国家身份', 'error');
                return;
            }
            
            const url = `/country-declaration?session_id=${encodeURIComponent(sessionId)}&committee_name=WTO争端解决委员会&agenda=国际贸易争端解决机制改革&country_id=${encodeURIComponent(selectedCountryId)}&country_name=${encodeURIComponent(selectedCountryName)}`;
            window.location.href = url;
        }



        // 显示提示信息
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
